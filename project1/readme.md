# SM4算法优化版本性能对比报告

## 测试环境
- **测试轮次**: 1,000,000 次加密操作
- **数据块大小**: 16 字节 (128位)
- **测试数据**: 相同的明文和密钥

## 性能对比表格

### 单块加密性能对比

| 优化版本 | 总耗时 (秒) | 平均耗时 (微秒/次) | 吞吐量 (MB/s) | 相对基础版本加速比 |
|----------|-------------|-------------------|---------------|-------------------|
| **基础版本** | 0.6375 | 0.6375 | 23.91 | 1.00x (基准) |
| **T-table优化** | 0.2815 | 0.2815 | 54.07 | **2.26x** |
| **AES-NI优化** | 0.1285 | 0.1285 | 118.79 | **4.96x** |
| **SIMD优化** | 0.1280 | 0.1280 | 119.24 | **4.98x** |

### 并行加密性能对比

| 优化版本 | 总耗时 (秒) | 平均耗时 (微秒/4块) | 吞吐量 (MB/s) | 相对单块版本提升 |
|----------|-------------|-------------------|---------------|-----------------|
| **AES-NI 4块并行** | 0.1289 | 0.5156 | 118.37 | 0.99x (无提升) |
| **SIMD 4块并行** | 0.0739 | 0.2960 | 206.38 | **1.73x** |

## 详细分析

### 性能排名
1. **SIMD 4块并行版本** - 206.38 MB/s (最快)
2. **SIMD单块优化版本** - 119.24 MB/s
3. **AES-NI单块优化版本** - 118.79 MB/s
4. **T-table优化版本** - 54.07 MB/s
5. **基础版本** - 23.91 MB/s (最慢)


#### 1. 单块加密优化效果
- **T-table优化**: 相比基础版本提升 **2.26倍**，通过预计算S-box和线性变换显著减少计算开销
- **AES-NI优化**: 相比基础版本提升 **4.96倍**，利用硬件加速指令大幅提升性能
- **SIMD优化**: 相比基础版本提升 **4.98倍**，通过向量化指令实现最佳单块性能

#### 2. 并行处理效果
- **AES-NI并行版本**: 性能与单块版本基本相同，说明并行实现存在问题或开销抵消了并行收益
- **SIMD并行版本**: 相比SIMD单块版本提升 **73%**，有效利用了SIMD的并行能力

#### 3. 技术对比
| 技术特点 | T-table | AES-NI | SIMD |
|----------|---------|---------|------|
| **实现复杂度** | 低 | 中 | 高 |
| **硬件依赖** | 无 | 需要AES-NI支持 | 需要SSE4.1支持 |
| **内存占用** | 1KB (256×4字节) | 适中 | 适中 |
| **并行潜力** | 有限 | 中等 | 优秀 |
| **兼容性** | 最佳 | 现代CPU | 良好 |
<img width="567" height="559" alt="屏幕截图 2025-08-14 234857" src="https://github.com/user-attachments/assets/a81d2042-96e3-42e4-b464-4faca3fe422d" />
<img width="581" height="375" alt="屏幕截图 2025-08-14 234726" src="https://github.com/user-attachments/assets/ca7502e5-b525-4b11-b765-b957ac9ad3b1" />
<img width="315" height="188" alt="image" src="https://github.com/user-attachments/assets/75e7bbe6-24b5-4118-8e0b-19b3c85ee3d4" />


## 结论

测试结果表明：
- **SIMD优化技术**在SM4算法加速中表现最佳，单块性能与AES-NI相当，但并行性能更优
- **并行处理**能显著提升整体吞吐量，SIMD 4块并行版本达到206+ MB/s
- **T-table优化**提供了良好的性能提升与兼容性平衡
- 不同优化技术适合不同的应用场景，应根据具体需求选择
